\documentclass[screen,anonymous,review,draft,natbib=false]{acmart} %% draft
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont{} B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

\acmDOI{...} % DOI - Insert your DOI below...
\acmISBN{...} % ISBN - Insert your conference/workshop's ISBN below...
\acmPrice{15.00}
\acmConference[Short Name]{Long Name}{dates}{venue}
\setcopyright{acmcopyright}
\copyrightyear{2020}
\acmYear{2020}
\acmDOI{}

\PassOptionsToPackage{final}{microtype}
\PassOptionsToPackage{usenames,dvipsnames,svgnames,table,x11names}{xcolor}
\PassOptionsToPackage{cache=false}{minted}
\usepackage{attrib}
\usepackage{fix-cm}
\usepackage{graphicx, color} 
\usepackage{fontspec,newunicodechar}
\usepackage{graphbox} %% an extension of graphix, for \includegraphics 
\usepackage{hyphenat} %% electromagnetic\hyp{}endioscopy
\usepackage[shortcuts]{extdash}
\usepackage{polyglossia} %% for xelatex use polyglossia
\setdefaultlanguage[variant=american]{english}
%% \usepackage{alltt} %% Commented in favor of fancyvrb, which minted loads
\usepackage{chngcntr} %% for changing counters in fixing the way sections, etc print.
\usepackage{hang} %% to include hanging indent packages, AFAIK better than {hanging}
\defaultfontfeatures{Ligatures=TeX,Mapping=tex-text}
% Needed for the bibliography commands
% ^Needed to build bib entries in text, outside bibliography
%% \usepackage{pdftexcmds} %% useful for LuaTex, not needed here
%% \usepackage{bibentry} %% For inserting full bib citations into the document. not needed w/biblatex
\usepackage{mathtools} %% loads amsmath w/improvements, which needs to be before hyperref
%% \usepackage{mathspec} -- causes a clash; subsumes fonstpec, must come after amsmath
\usepackage{latexsym} %% additional symbols
%%\usepackage[warnings-off={mathtools-colon}]{unicode-math} -- can't be added, b/c it overwrites \eth
% \usepackage{amssymb}  %% -- can't be added, b/c it overwrites \Bbbk 
\usepackage{wasysym}  %% additional symbols
\usepackage{bold-extra} %% \textsc{ \textbf{This is bold small capitals} }
\usepackage{tabu} %% the currently-preferred table package
%% But! See: https://tex.stackexchange.com/questions/121841/is-the-tabu-package-obsolete
\usepackage{pdflscape} %% for \begin{landscape} ..., to change part of doc to landscape
%% \usepackage{multicol} %% provides multicol environment
\usepackage{morefloats} %% raise limit for max # floats above 18
\usepackage{placeins} %% gives \FloatBarrier, which limits float movements [section]
\usepackage{needspace} %% prevents page breaks right after section names
\usepackage{wrapfig} %% adds \begin{wrapfigure}[lh]{pos}[ohang]{w}
% \usepackage{floatrow} %% improved version of sidecap, for horizontal caption placement
\usepackage{etaremune} %% rev enumerate. obv :D
\usepackage{mathrsfs}
\usepackage{calrsfs}
\usepackage{layout}
%\usepackage{showframe} Turn on to see the frame around the stuff 
\usepackage{mathalfa} %% https://tex.stackexchange.com/questions/58098/what-are-all-the-font-styles-i-can-use-in-math-mode/58124#58124
\usepackage{bbold}
%% eufrak package is redundant b/c amsmath
\usepackage{bigintcalc}
\usepackage{ifdraft}
\usepackage{zref}
\usepackage{classlist}
\usepackage{dsfont}
\usepackage{subcaption} %% allows subcaptions before captions 
\usepackage[bottom]{footmisc} %% for customizing footnotes
%\usepackage{varioref} %% adds \vref, w/context sensitivity referencing
\usepackage[all]{hypcap} %% resolves issues w/captions & hyperref. Load after hyperref
\usepackage[capitalize,nameinlink]{cleveref} %% adds \crefrange{}{} and \cpagerefrange{}
\RequirePackage[backend=biber,%
                abbreviate=true,%
                dateabbrev=true,%
                isbn=true,%
                doi=true,%
                urldate=comp,%
                url=true,%
                maxcitenames=2,%
                maxbibnames=4,%
                backref=false,%
                style=ACM-Reference-Format,%
                natbib=true,
                autocite=plain,%
                block=space,%
                alldates=terse,%
                isbn=false,%
                defernumbers=true,%
                sortcites=true,%
                sortsets=true,%
                eprint=false,%
                language=american]{biblatex}
\usepackage{nag} %% should complain about old and outdated commands
\usepackage{mdframed} %% adds \begin{framed} environment, and other simple framing boxes
\usepackage{fancybox} %% adds \doublebox, \ovalbox, and \shadowbox 
%% must load fancybox before minted
\usepackage{xpatch} %% for etoolbox w/biblatex
\usepackage{minted} %% My brand new baby for highlighting source code
%% also adds \begin{framed} environment
\usepackage{mathpartir} %% Didier Remy's typesetting for proofs. 
\usepackage[strict,autostyle]{csquotes} %% enquote &c that doesn't interfere w/cdlatex usage http://ftp.lyx.org/pub/tex-archive/macros/latex/contrib/csquotes/csquotes.pdf
\usepackage[xspace]{ellipsis} %% http://tex.stackexchange.com/questions/73467/what-is-best-method-to-insert-an-ellipsis-in-a-xetex-document#73469
\usepackage{pseudocode}
\usepackage{epigraph}
\usepackage{algorithmicx}
\usepackage[noend]{algpseudocode}
\usepackage{tikz-cd}
\usepackage{algorithm} %% must come after floatrow [chapter] 
\usepackage[defaultlines=3,all]{nowidow} %% Eliminates widow and orphans 
\addbibresource{streams.bib}

\setmonofont{DejaVuSansMono}[Scale=MatchLowercase] %% What is this scale option?
\tracinglostchars=2

\newmintinline[rackinline]{racket}{}
\newmintinline{prolog}{}

%% defines posscite, \posscites, \Posscites
%% From https://tex.stackexchange.com/a/307461/109698
\DeclareNameFormat{labelname:poss}{% Based on labelname from biblatex.def
  \nameparts{#1}% Not needed if using Biblatex 3.4
  \ifcase\value{uniquename}%
    \usebibmacro{name:family}{\namepartfamily}{\namepartgiven}{\namepartprefix}{\namepartsuffix}%
  \or%
    \ifuseprefix%
      {\usebibmacro{name:first-last}{\namepartfamily}{\namepartgiveni}{\namepartprefix}{\namepartsuffixi}}
      {\usebibmacro{name:first-last}{\namepartfamily}{\namepartgiveni}{\namepartprefixi}{\namepartsuffixi}}%
  \or%
    \usebibmacro{name:first-last}{\namepartfamily}{\namepartgiven}{\namepartprefix}{\namepartsuffix}%
  \fi
  \usebibmacro{name:andothers}%
  \ifnumequal{\value{listcount}}{\value{liststop}}{'s}{}}
\DeclareFieldFormat{shorthand:poss}{%
  \ifnameundef{labelname}{#1's}{#1}}
\DeclareFieldFormat{citetitle:poss}{\mkbibemph{#1}'s}
\DeclareFieldFormat{label:poss}{#1's}
\newrobustcmd*{\posscitealias}{%
  \AtNextCite{%
    \DeclareNameAlias{labelname}{labelname:poss}%
    \DeclareFieldAlias{shorthand}{shorthand:poss}%
    \DeclareFieldAlias{citetitle}{citetitle:poss}%
    \DeclareFieldAlias{label}{label:poss}}}
\newrobustcmd*{\citeposs}{%
  \posscitealias%
  \textcite}
\newrobustcmd*{\Citeposs}{\bibsentence\citeposs}
\newrobustcmd*{\Citeposses}{%
  \posscitealias%
  \textcites}

\newcommand{\meta}[2]{[\textsc{#1}: \emph{#2}]}
\newcommand{\todo}[1]{\textcolor{red}{\meta{TODO}{#1}}}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}
\title{Eager Backtracking, Less Interleaving with Even More Odd
  Streams (Exegetical Pearl)}
% \title{Consolidating Approaches to Eager Backtracking}
% \title{Less Backtracking in Eager Languages with Even Odder Streams
%   and Delimited Control}

\author{Us}
\email{void@example.com}
\orcid{1234-5678-9012}
\affiliation{%
  \institution{Northeastern University}}


%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
% \renewcommand{\shortauthors}{}

\begin{abstract}
\end{abstract}

\begin{CCSXML}
<ccs2012>
   <concept>
       <concept_id>10003752.10003790.10003795</concept_id>
       <concept_desc>Theory of computation~Constraint and logic programming</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
 </ccs2012>
\end{CCSXML}

\ccsdesc[500]{Theory of computation~Constraint and logic programming}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{streams, backtracking} 


%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle


% \setlength\epigraphwidth{.5\textwidth}

% \epigraph{Flowing streams in all your windings stray,}
% {Eliza and Sarah G Wolcott, \emph{The Meeting of the Waters}}

\section{Introduction}\label{sec:intro}

In \citetitle{danvy2002unifying}, \citeauthor{danvy2002unifying}
connect through monadic interpreters four different implementations of
backtracking, namely: list-based, stream-based, and one- and
two-continuation based implementations. Inter alia, they make the
following observation:
%
\begin{quote}
  Just as the continuation monad from Fig. 4 can be conceptually
  linked to the list monad, the present [success and failure]
  continuation monad can be linked to the stream monad by a Church
  encoding of the data type of streams
\end{quote}
%
The authors do not dwell long on their observation. They remark on the
novelty of this point and proceed to use the fact of this relationship
to guide their compilation of goal-oriented languages. But
\citeauthor{danvy2002unifying} perhaps give themselves too little
credit; the interrelationships they observe are less straightforward
than they might first appear to the casual reader. These additional
subtleties become more obvious when we extend the relationship to link
in an eager language a stream datatype with eager and lazy
constructors to its continuation-based variant. These complexities
appear more obvious still when we add interleaving.

\begin{listing}
\begin{minted}[autogobble,stripall,linenos]{ml}
datatype 'a list   = Nil | Cons of 'a * 'a list
datatype 'a stream = End | More of 'a * (1 -> 'a stream)
\end{minted}
\caption{Datatypes for eager lists and odd streams}
\label{mnt:eager-lazy-datatypes}
\end{listing}

The \mintinline{ml}|stream| datatype we define in
\cref{mnt:eager-lazy-datatypes}, unlike the \mintinline{ml}|list| datatype,
demands a thunk as the second argument to the \mintinline{ml}|More|
constructor, to delay evaluation. We could have instead appealed to
lazy constructors (e.g. \mintinline{ml}|lazy|) or retreated to a lazy
host language. Those alternative choices, however, bury the
relationship we want to further explore.

The streams of \cref{mnt:eager-lazy-datatypes} are
odd. \citeauthor{wadler1998add}, in \citetitle{wadler1998add},
classify implementations of lazy stream datatypes in an eager host
language as either \enquote{even} or \enquote{odd}. Those names
reflect both the number of \rackinline|cons|es in the streams they
construct (an even or odd number respectively) and also the
peculiarity of the latter: the odd-style of forces just a bit too much
evaluation leading sometimes to subtle bugs. Using these same
constructs, though, \citeauthor{wadler1998add} show how to construct
an even kind of stream. We reproduce this definition in
\cref{mnt:even-streams-with-difficulty}\footnote{This is in fact a
  modified version of \citeposs{wadler1998add} definition; their
  original version introduces a construct that adds not just
  non-strict evaluation but also memoization.}.
  
\begin{listing}
\begin{minted}[autogobble,stripall,linenos]{ml}
datatype 'a stream_ = End_ | More_ of 'a * 'a stream
withtype 'a stream  = (1 -> 'a stream_)
\end{minted}
\caption{\citeposs{wadler1998add} datatype for even streams with difficulty}
\label{mnt:even-streams-with-difficulty}
\end{listing}

We consider streams an even more peculiar flavor. Unlike either
\citeauthor{wadler1998add,danvy2002unifying}, we construct streams
without a simple, fixed, regular structure to their
\rackinline|delay|s. Furthermore, we must take more caution as we
construct these streams in our eager host language. For the price of
these drawbacks, however, we take several benefits. If we know that we
will never re-use the values of these computations, then any
memoization wastes resources. This situation is not contrived: the
Racket language~\cite{flatt2010reference} has a built-in construct
\rackinline|delay/name| just for such situations. Unlike other
definitions of streams, we can place \rackinline|delay|s precisely
where they are necessary, and nowhere else. Further, since delays are
now optional instead of mandatory, the delays can then double also as
markers for the positions in which to interleave when combining two
streams.

\begin{listing}
\begin{minted}[autogobble,stripall,linenos]{ml}
datatype 'a stream__ = Nil__ | Cons__ of 'a * 'a stream__ | (1 -> 'a stream__)
\end{minted}
\caption{Even more odd streams}
\label{mnt:even-more-odd}
\end{listing}

We can see the streams of \cref{mnt:even-more-odd} as a mixture of
both the even and odd styles of defining streams. Unlike either of
\citeposs{wadler1998add}, the delayed evaluation is not subsidiary to
a part of a union type, but a member of the union itself. This means
that unlike \citeposs{danvy2002unifying} and
\citeauthor{wadler1998add} odd streams, delayed computations are
themselves possible values of the datatype. Unlike
\citeauthor{wadler1998add} even streams though, pairs of values are
still themselves members of the datatype. This change impacts both the
datatype that we can possibly return, as well as the structure of
their corresponding continuation-based implementation.

If the lists of \cref{mnt:eager-lazy-datatypes} correspond to a
single-continuation implementation of backtracking, and the streams of
\cref{mnt:eager-lazy-datatypes} correspond to the two-continuation
implementation of backtracking, then to what sort of continuation
based implementation of backtracking should our streams in
\cref{mnt:even-more-odd} correspond? 




\section{Background}\label{sec:background}


% Wadler even odd. Even *odder* streams.

% Their connection via Danvy to the multi continuation delimited control
% operations

% Those connections to the ``Backtracking, interleaving'' paper

% Minimal amounts of interleaving that you'd require.

% Unfolding to get there, via connection w/miniKanren streams. 

% History of the multi-continuation implementation of LP.


% \todo{What about that linear one designed to be more efficient in
%   practice? Add that one in here.}

% \section{Theory}\label{sec:theory}

% \section{Performance}\label{sec:performance}

% \begin{verbatim}
% In generating 4 thrines (fresh), we had the following
% succeed-ct: 216376
% clash-ct: 97712
% cycle-ct: 6892
% \end{verbatim}


% The numbers for the more complicated queries from
% \citet{byrd2017unifiedapproach} are also interesting to see.

% It would be interesting to know the ``run lengths'' of these successes
% and either kind of failure as we compute, either in between
% interleaves or in each interleave. For the \citet{byrd2017unifiedapproach}
% final interpreter example. It seems that in practice on many examples
% \citeposs{robinson1965machine} version out-performs the
% asymptotically-superior algorithms.

% \href{file://~/Downloads/icfp-17/shared/}{file://~/Downloads/icfp-17/shared/}
% \todo{Run}

% \section{Related}\label{sec:related}


% \section{Conclusions}\label{sec:conclusions}

% %%
% %% The acknowledgments section is defined using the "acks" environment
% %% (and NOT an unnumbered section). This ensures the proper
% %% identification of the section in the article metadata, and the
% %% consistent spelling of the heading.

% \begin{acks}
%   We thank you all. 
% \end{acks}

\printbibliography{}

\end{document}
\endinput

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
